name: Deployment
permissions:
  contents: write
on:
  push:
    branches:
      - main
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '22'
      - name: Install dependencies
        run: npm install
      - name: Build project
        run: npm run build
      - name: Prepare folders
        run: |
          mkdir all
          mv * ./all/ &
          sleep 2
          mv all/dist ./
          rm -rf all .github .gitignore
          mv dist/* ./
          rmdir dist
      - name: Push dist to dist branch
        run: |
          git config --global user.name 'Meloromeo Bot'
          git config --global user.email 'meloromeo@bot.github.com'
          git checkout -B dist
          git add . -f
          git commit -m "Deploying to dist branch"
          git push origin dist --force